(()=>{"use strict";({156(){var e=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function c(e){try{s(r.next(e))}catch(e){i(e)}}function u(e){try{s(r.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(c,u)}s((r=r.apply(e,t||[])).next())})};function t(t){return e(this,void 0,void 0,function*(){try{return(yield chrome.scripting.executeScript({target:{tabId:t},func:()=>{const e=e=>{var t,n;return(null===(t=document.querySelector(`meta[name="${e}"]`))||void 0===t?void 0:t.getAttribute("content"))||(null===(n=document.querySelector(`meta[property="${e}"]`))||void 0===n?void 0:n.getAttribute("content"))};return{description:e("description")||e("og:description")||"",ogImage:e("og:image")||""}}}))[0].result}catch(e){return{description:"",ogImage:""}}})}chrome.runtime.onMessage.addListener((n,r,o)=>"CAPTURE_TAB"===n.type?(function(n){return e(this,void 0,void 0,function*(){try{const[e]=yield chrome.tabs.query({active:!0,currentWindow:!0});if(!e)throw new Error("No active tab found");const r=yield chrome.tabs.captureVisibleTab({format:"jpeg",quality:80}),o=yield t(e.id),i={title:e.title,url:e.url,favicon:e.favIconUrl,screenshot:r,description:(null==o?void 0:o.description)||"",ogImage:(null==o?void 0:o.ogImage)||"",tags:n||[],timestamp:(new Date).toISOString()},{pendingCaptures:c=[]}=yield chrome.storage.local.get("pendingCaptures"),u=[...c,i];return yield chrome.storage.local.set({pendingCaptures:u}),console.log("[Background] Capture successful. Pending count:",u.length),{success:!0,count:1}}catch(e){return console.error("Capture failed:",e),{success:!1,error:e.message}}})}(n.tags).then(o),!0):"CAPTURE_ALL_TABS"===n.type?(function(){return e(this,void 0,void 0,function*(){var e;try{const n=yield chrome.tabs.query({currentWindow:!0});let r=0;for(const o of n){if(!(null===(e=o.url)||void 0===e?void 0:e.startsWith("http"))||o.url.includes("chrome://"))continue;if(o.url.match(/localhost:(3000|3001|3002|3003|3004|3005)/))continue;if(o.url.includes("whitebroawd-web.vercel.app"))continue;const n=yield t(o.id),i={title:o.title,url:o.url,favicon:o.favIconUrl,description:(null==n?void 0:n.description)||"",ogImage:(null==n?void 0:n.ogImage)||"",timestamp:(new Date).toISOString()},{pendingCaptures:c=[]}=yield chrome.storage.local.get("pendingCaptures");yield chrome.storage.local.set({pendingCaptures:[...c,i]}),r++}return{success:!0,count:r}}catch(e){return{success:!1,error:e.message}}})}().then(o),!0):"GET_PENDING_CAPTURES"===n.type?(function(){return e(this,void 0,void 0,function*(){const{pendingCaptures:e=[]}=yield chrome.storage.local.get("pendingCaptures");return e.length>0&&(console.log(`[Background] Sending ${e.length} captures to whiteboard.`),yield chrome.storage.local.set({pendingCaptures:[]})),e})}().then(o),!0):void 0)}})[156].call({})})();